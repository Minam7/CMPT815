---
title: "Data Analysis of Massive Online Open Courses"
subtitle: "Computer Systems and Performance Evaluation"
author: "Mina Mousavifar"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

<div align="center">
<img  src="images/mooc.jpg"  align = 'center'>
</div>

***
<p>
Nowadays, Massive Open Online Course systems have gained lots of attention and are used in different levels of education.
In this project, I use [OULAD](https://analyse.kmi.open.ac.uk/open_dataset), which is the anonymized Open University Learning Analytics Dataset (OULAD). It contains data about courses, students and their interactions with Virtual Learning Environment (VLE) for seven selected courses (called modules).
</p>

<p>
In this project, I mainly focus on the following insights.

• *Long-term popularity evolution of a course based on registration*

• *The relation between student assessment and use of online resources*

• *The relation between online resources and students score*

• *Temporal patterns of time spent in MOOCs*

• *Characteristics Impacting Online Usage of Resources*
</p>

***
<h4>
Importing and cleaning data
</h4>

```{r, message=FALSE, warning=FALSE, comment=NA}
library(readr)

oulad_assessments = readr::read_csv("data/anonymisedData/assessments.csv")
oulad_courses = readr::read_csv("data/anonymisedData/courses.csv")
oulad_studentAssessment = readr::read_csv("data/anonymisedData/studentAssessment.csv")
oulad_studentInfo = readr::read_csv("data/anonymisedData/studentInfo.csv")
oulad_studentRegistration = readr::read_csv("data/anonymisedData/studentRegistration.csv")
oulad_studentVle = readr::read_csv("data/anonymisedData/studentVle.csv")
oulad_vle = readr::read_csv("data/anonymisedData/vle.csv")
```

***

<h4> Long-term popularity evolution of courses based on registration </h4>

```{r, message=FALSE, warning=FALSE, comment=NA}
library(dplyr)
library(highcharter)

oulad_course_popularity <- oulad_studentRegistration %>% group_by(code_module, code_presentation) %>% summarise(count = n())
oulad_course_popularity <- with(oulad_course_popularity, oulad_course_popularity[order(code_presentation, code_module, count),])

mean_student_registration = mean(oulad_course_popularity[['count']])

oulad_course_popularity  %>% mutate(code_presentation = ifelse(code_presentation == '2013B', '2013January', ifelse(code_presentation == '2013J', '2013September', ifelse(code_presentation == '2014B', '2014January', '2014September')))) %>% 
  hchart(type = "line", hcaes(x = code_presentation, y = count, group = code_module)) %>% 
  hc_yAxis(title = list(text = "Popularity"), tickInterval = 100,
           plotLines = list(list(color = "#FF0000", width = 2, value = mean_student_registration, dashStyle = 'shortdash'))
           ) %>% 
  hc_xAxis(title = list(text = "Term"), categories= list('2013January','2013September','2014January','2014September')) %>% 
  hc_title(text = "Course Popularity based on number of Student Registration", style = list(fontWeight = "bold"))
```

<p>
As we can see in this chart, more than average popular courses have more students in September terms. However, less popular courses don't follow such a pattern.
</p>
***

<h4> Courses online resource summary</h4>

```{r, message=FALSE, warning=FALSE, comment=NA}
oulad_vle_summary <- oulad_vle %>% group_by(code_module, code_presentation, activity_type) %>% summarise(count = n())
```

<p>
Number of courses online resources across 4 terms:
</p>

```{r, message=FALSE, warning=FALSE, comment=NA}
knitr::kable(oulad_vle_summary %>% group_by(code_module) %>% summarise(count = n()), col.names = c("Course Name", "Number of Online Resources"))
```

<p>
Online resource popularity across 4 terms:
</p>

```{r, message=FALSE, warning=FALSE, comment=NA}
# knitr::kable(oulad_vle_summary %>% group_by(activity_type) %>% summarise(count = n()) %>% arrange(desc(count)), col.names = c("Online Resource", "Count"))

hchart(oulad_vle_summary %>% group_by(activity_type) %>% summarise(count = n()), "treemap", hcaes(x = activity_type, value = count, color = count), name = 'count')
```

<p>
Usage of online resources across terms:
</p>

```{r, message=FALSE, warning=FALSE, comment=NA}
library("viridis")

oulad_student_vle_summary <- oulad_studentVle %>% group_by(id_student, code_module, code_presentation) %>% summarise(clicks = sum(sum_click))

fntltp <- JS("function(){
  return this.point.x + ' ' +  this.series.yAxis.categories[this.point.y] + ':<br>' +
  Highcharts.numberFormat(this.point.value, 2);
}")

hchart(oulad_student_vle_summary %>% group_by(code_module, code_presentation) %>% summarise(clicks = sum(clicks)) %>% mutate(code_presentation = ifelse(code_presentation == '2013B', '2013January', ifelse(code_presentation == '2013J', '2013September', ifelse(code_presentation == '2014B', '2014January', '2014September')))), "heatmap", hcaes(x = code_presentation, y = code_module, value = clicks)) %>%
  hc_colorAxis(stops = color_stops(10, rev(inferno(10))),
               type = "logarithmic") %>% 
  hc_yAxis(title = list(text = "Course Name"), reversed = TRUE, tickLength = 0, gridLineWidth = 0, minorGridLineWidth = 0,
           labels = list(style = list(fontSize = "8px"))) %>% 
  hc_xAxis(title = list(text = "Term")) %>% 
  hc_tooltip(formatter = fntltp) %>% 
  hc_title(text = "Heatmap of online resource clicks") %>% 
  hc_legend(layout = "vertical", verticalAlign = "top",
            align = "right", valueDecimals = 0) %>% 
  hc_size(height = 800)
```

<p>
As we can see in this chart, these resources might even have more than 2 million clicks during the term, which relies on different factors such as quality of the material, level of interaction needed for these resources and even students registered for such courses.

In the following part, the efficacy of these resources will be explored.
</p>


***
<h4>
The relation between student assessment and usage of online resources
</h4>

```{r, message=FALSE, warning=FALSE, comment=NA}
library(ggplot2)

oulad_vle_course_summary <- oulad_vle %>% group_by(code_module, code_presentation) %>% summarise(count = n())

oulad_full_vle_summary <- inner_join(oulad_student_vle_summary, oulad_vle_course_summary, by = c("code_module", "code_presentation")) %>% mutate(usage = clicks*100/count)

oulad_full_student_assessment <- inner_join(oulad_assessments, oulad_studentAssessment, by = 'id_assessment')

oulad_vle_assessment <- inner_join(oulad_full_vle_summary, oulad_full_student_assessment, by = c("id_student", "code_module", "code_presentation")) %>% mutate(weight_score = weight*score)%>% group_by(id_student, code_module, code_presentation) %>% summarise(score = sum(weight_score), weight = sum(weight), usage = mean(usage)) %>% mutate(final_score = score/weight)
oulad_vle_assessment <- na.omit(oulad_vle_assessment)

mean_vle_usage <- mean(oulad_vle_assessment[['usage']])
oulad_vle_less_use <- oulad_vle_assessment %>% filter(usage <= mean_vle_usage) %>% mutate(type = 'low resource usage')
oulad_vle_more_use <- oulad_vle_assessment %>% filter(usage > mean_vle_usage) %>% mutate(type = 'high resource usage')

oulad_full_vle_assessment <- rbind(oulad_vle_less_use, oulad_vle_more_use)
oulad_full_vle_assessment <- na.omit(oulad_full_vle_assessment)

p <- ggplot(oulad_full_vle_assessment,aes(x = final_score, fill = type)) + geom_density(alpha= 0.4) + ggtitle("Density of Students Scores Based on Resources Usage") + xlab("Student Final Score")
p
```
<p>
As we can see in this chart, students with more resources have higher scores than others with low usage of resources. In order to statistically examine this claim, a t-test will be applied.
</p>

<p>
Our Hypothesis is: *Students who use online resources more would have a better score.*
<br>
In order to test such a Hypothesis, we conduct a Welch two-sample t-test. We test whether students with low usage of online resources would have a better score.
</p>

```{r, message=FALSE, warning=FALSE, comment=NA}
t.test(oulad_vle_less_use$final_score, oulad_vle_more_use$final_score, alternative = 'less')
```
<p>
As we can see here, the probability that the students with low usage of online resources have more scores than the other group is low enough to refute our hypothesis. So usage of online resources impacts the score of students.
</p>

***
<h4>
Courses that have more resources would result in a higher final score
</h4>

```{r, message=FALSE, warning=FALSE, comment=NA}
library(corrplot)

oulad_course_vle <- oulad_vle_summary %>% group_by(code_module, code_presentation) %>% summarise(resource_count = sum(count))

oulad_full_course_vle <- oulad_full_vle_assessment %>% group_by(code_module, code_presentation) %>% summarise(mean_score = mean(final_score), usage = mean(usage)) %>% inner_join(oulad_course_vle, by = c("code_module", "code_presentation"))

cor_course_data <- cor(data.matrix(oulad_full_course_vle %>% ungroup() %>% mutate(code_module = factor(code_module), code_presentation = factor(code_presentation))))
colnames(cor_course_data) <- c("Course Name", "Term", "Average Score", "Online Resource Usage", "Number of Resources")
rownames(cor_course_data) <- c("Course Name", "Term", "Average Score", "Online Resource Usage", "Number of Resources")
corrplot(cor_course_data, method = "color", tl.cex = 0.75/par("cex"), cl.cex = 0.75/par("cex"))
```
<p>
As we see in this chart, the average score of courses mostly relies on the usage of online resources rather than the quantity of these resources. So we statistically examine this claim.
</p>

<p>
Our Hypothesis is: *Courses that have more online resources would have a better score.*
<br>
In order to test such a Hypothesis, we conduct a Welch two-sample t-test. We test whether courses with low online resources would lead to a better score.
</p>
```{r, message=FALSE, warning=FALSE, comment=NA}
mean_course_count <- mean(oulad_full_course_vle[['resource_count']])

oulad_course_less_resource <- oulad_full_course_vle %>% filter(resource_count <= mean_course_count) %>% mutate(type = 'Little number of resource')
oulad_course_more_resource <- oulad_full_course_vle %>% filter(resource_count > mean_course_count) %>% mutate(type = 'High number of resource')


t.test(oulad_course_less_resource$mean_score, oulad_course_more_resource$mean_score, alternative = 'greater')
```

<p>
As we can see here, the probability that the courses with low resources would result in lower students' scores isn't low enough to refute our Hypothesis, so we can't infer such relation.

Moreover, we can see that the mean of final scores with a lower number of resources is even slightly more than courses with a higher number of resources.

So we test the relation between usage of online course material and the students' final results.
<br>
Our Hypothesis is: *Courses who have more online resources usage would have a better score.*
<br>
In order to test such a Hypothesis, we conduct a Welch two-sample t-test. We test whether courses with low online resources usage would lead to a better score.
</p>

```{r, message=FALSE, warning=FALSE, comment=NA}
mean_course_usage <- mean(oulad_full_course_vle[['usage']])

oulad_course_less_resource <- oulad_full_course_vle %>% filter(usage <= mean_course_count) %>% mutate(type = 'Low usage')
oulad_course_more_resource <- oulad_full_course_vle %>% filter(usage > mean_course_count) %>% mutate(type = 'High usage')


t.test(oulad_course_less_resource$mean_score, oulad_course_more_resource$mean_score, alternative = 'less')
```

<p>
As we can see here, the probability that the courses with low usage of online resources would result in lower students' scores is low enough to refute our hypothesis. 

So we can infer that this is a matter of quality rather than quantity. The number of resources isn't critical, but resources should be beneficial for the student to result in better scores.
</p>

***
<h4> Temporal patterns of time spent in MOOCs</h4>

```{r, message=FALSE, warning=FALSE, comment=NA}
oulad_vle_info <- oulad_studentVle %>% group_by(date, code_module, code_presentation) %>% summarize(clicks = sum(sum_click))

p <- ggplot(data=oulad_vle_info %>% mutate(code_presentation = ifelse(code_presentation == '2013B', '2013January', ifelse(code_presentation == '2013J', '2013September', ifelse(code_presentation == '2014B', '2014January', '2014September')))), aes(x= date, y=clicks, colour=code_module)) + geom_line() + ggtitle("Temporal Pattern of Courses Online Resources") + guides(color=guide_legend(title="Course")) + facet_wrap(~code_presentation)
p
```

<p>
As we can see in these charts, at the beginning of the term, which students are motivated for the course, usage of online resources experiences a peak. However, as we proceed to the end of the term, the usage of these resources decrease due to lost of interest until we reach the end of the term. Final exams result in the highest usage of resources for each course in each term.
</p>

***
<h4> Characteristics impacting online usage of resources</h4>

```{r, message=FALSE, warning=FALSE, comment=NA}

oulad_full_info_assessment <- oulad_full_vle_assessment %>% inner_join(oulad_studentInfo, by = c('id_student', 'code_module', 'code_presentation')) %>% 
  select(code_module, code_presentation, usage, type, gender, region, highest_education, age_band, studied_credits, disability, final_score)

cor_info_data <- cor(data.matrix(oulad_full_info_assessment %>% ungroup() %>%
                                   select(-id_student, -type, -final_score) %>% 
                                   mutate(code_module = factor(code_module), 
                                          code_presentation = factor(code_presentation),
                                          gender = factor(gender), 
                                          region = factor(region), 
                                          highest_education = factor(highest_education),
                                          age_band = factor(age_band),
                                          disability = factor(disability))))




colnames(cor_info_data) <- c("Course Name", "Term", "Resource Usage", "Gender", "Region", "Highest Education", "Age", "Studies Credits", "Disability")
rownames(cor_info_data) <- c("Course Name", "Term", "Resource Usage", "Gender", "Region", "Highest Education", "Age", "Studies Credits", "Disability")
corrplot(cor_info_data, method = "color", tl.cex = 0.75/par("cex"), cl.cex = 0.75/par("cex"))
```

<p>
As we can see in the previous correlation plot, resource usage might have relations with gender, age, and studied credits, which will be investigated in the following.
</p>

```{r, message=FALSE, warning=FALSE, comment=NA}
oulad_factor <- oulad_full_info_assessment %>% group_by(id_student, gender, age_band, studied_credits) %>% summarise(usage = mean(usage))

mean_usage = mean(oulad_factor[['usage']])

oulad_factor <- oulad_factor %>% mutate(type = ifelse(usage < mean_usage, 'low usage', 'high usage'))

p <- ggplot(data = oulad_factor,aes(x = usage,fill = gender)) +
  geom_histogram(binwidth = 50) + ggtitle("Usage Based on Gender") + xlim(0, 5000) +
  guides(color=guide_legend(title="Gender"))
p
```

<p>
As we can see in this chart, we have more female students than male students with low usage of system resources. However, this difference decreases as the usage of students increases, and we have a more balanced usage between both genders.
</p>

```{r, message=FALSE, warning=FALSE, comment=NA}
oulad_age_factor <- oulad_factor %>% group_by(age_band, type) %>% summarise(count = n()) %>% ungroup()


oulad_age_factor %>% hchart(type = "column",hcaes(x = age_band, y = count, group = type)) %>% 
  hc_xAxis(title = list(text = "Age Range")) %>% 
  hc_title(text = "Usage Based on Age Range", style = list(fontWeight = "bold")) %>% 
  hc_add_theme(hc_theme_flat())
```

<p>
As we can see in this chart, the majority of the students are less than 35 years old, and the higher percentage of them have more resource usage than other age groups. Interestingly, the group with more than 55 years old, have more heavy users compared to light users.
</p>

```{r, message=FALSE, warning=FALSE, comment=NA}
p <- ggplot(data = oulad_factor,aes(x = studied_credits, y = usage, colour = type)) +
  geom_smooth(se=FALSE) + ggtitle("Usage Based on Studied Credits") +
  guides(color=guide_legend(title="Studied Credits")) +
  xlab('studied credits')
p
```

<p>
As we can see in this chart, students' patterns would have more influence as the students gain experience in this field. If a student is a heavy user at first, it will use more as its credits increases and vice-versa.
</p>

```{r, message=FALSE, warning=FALSE, comment=NA}

```